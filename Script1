#Comandos iniciais
apt-get update -y
apt-get upgrade -y
apt-get install curl -y
apt-get install nano

#Instalar Squid3
apt-get install squid3 -y

#Adiciona a porta ssh 443 e dá compressão nela
sed -i "s/#Port 22/Port 22/g" /etc/ssh/sshd_config
printf "
Port 443\n
Compression yes \n" >> /etc/ssh/sshd_config

#Apaga o squid.conf e cria um novo
cd /etc/squid*
rm squid.conf
nano squid.conf
#Cola o novo squid na pasta squid.conf criado acima

#Squid By: Sr. Das Estrelas

acl vps1 dstdomain -i 127.0.0.1
acl vps2 dstdomain -i localhost
acl vps3 dstdomain -i IP_DA_VPS
acl vps4 dstdomain -i .br
acl vps5 dstdomain -i .com
acl vps6 dstdomain -i .net

acl CONNECT method CONNECT
acl GET method GET
acl POST method POST
acl OPTIONS method OPTIONS
acl HEAD method HEAD

http_access allow vps1
http_access allow vps2
http_access allow vps3
http_access allow vps4
http_access allow vps5
http_access allow vps6
cache deny all
http_access deny all

http_port 80
http_port 8080
http_port 3128
visible_hostname SrdasEstrelas

forwarded_for off
via off

#Desinstala o apache
apt-get remove apache2 -y

#Reconfigura o novo squid.
squid3 start
squid3 -k reconfigure

#Recarrega o ssh
service ssh reload
service sshd reload

#Remove pacotes que não são mais utilizados
apt-get autoremove -y

#Restarte no squid e ssh

service squid3 restart
service ssh restart

#Agora crie um usuario e senha para a VPS
